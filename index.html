<!DOCTYPE html>

<html>
<head>
    <title>AudioContext</title>
    <style>
        .control-group label{
            display: block
        }
        .control-group input{
            width: 100%;
        }
        .control-group input[type=number]{
            width: 20%;
        }
        .fieldset-group{
            clear: both;
        }
        [class*=span]{
            float:left;
            padding-right: 2%;
        }
        .span-12{
            width: 100%;
            padding-right: 0;
        }
        .span-9{
            width: 73%;
        }
        .span-6{
            width: 48%
        }
        .span-3{
            width: 23%;
        }
    </style>
</head>

<body>
<form>
    <div class='fieldset-group'>
        <div id='oscilliscope' class='span-6'>
            <canvas id='oscilliscopeVisualiser'></canvas>
        </div>
        <div class='span-6'>
            <button type='button' id='dualOscillatorsOn'>Start</button>
            <button type='button' id='dualOscillatorsOff'>Stop</button>
            <button type='button' id='captureWaveform'>Capture waveform</button>
            <button type='button' id='animateWaveform'>Animate waveform</button>
        </div>
    </div>
    <fieldset id='masterVolume' class='fieldset-group'>
        <legend>Mater volume</legend>
        <div class='control-group'>
            <label for='volume'>Volume</label>
            <input type='range' min='0' max='1' step='0.1' value='1' id='volume'>
        </div>
    </fieldset>
    <fieldset id='dynamics'>
        <legend>Dynamics</legend>
        <div class='control-group'>
            <label for='dynamicsThreshold'>Threshold</label>
            <input type='range' min='-100' max='0' step='0.1' value='-24' id='dynamicsThreshold'>
        </div>
        <div class='control-group'>
            <label for='dynamicsKnee'>Knee</label>
            <input type='range' min='0' max='40' step='1' value='30' id='dynamicsKnee'>
        </div>
        <div class='control-group'>
            <label for='dynamicsRatio'>Ratio</label>
            <input type='range' min='1' max='20' step='0.1' value='12' id='dynamicsRatio'>
        </div>
        <div class='control-group'>
            <label for='dynamicsReduction'>Reduction</label>
            <input type='range' min='-20' max='0' step='0.1' value='0' id='dynamicsReduction'>
        </div>
        <div class='control-group'>
            <label for='dynamicsAttack'>Attack</label>
            <input type='range' min='0' max='1' step='0.001' value='0.003' id='dynamicsAttack'>
        </div>
        <div class='control-group'>
            <label for='dynamicsRelease'>Release</label>
            <input type='range' min='0' max='1' step='0.001' value='0.25' id='dynamicsRelease'>
        </div>
    </fieldset>
    <fieldset id='vca'>
        <legend>VCA</legend>
        <div class='control-group'>
            <label for='vcaGain'>Gain</label>
            <input type='range' min='0' max='1' step='0.1' value='1' id='vcaGain'>
        </div>
        <div class='control-group'>
            <label for='gain'>Gain scale</label>
            <input type='number' min='1' step='1' value='1' id='vcaGainScale'>
        </div>
        <div class='control-group'>
            <label for='gain'>Distortion</label>
            <input type='range' min='0' max='8000' step='1' value='100' id='vcaDistortion'>
        </div>
    </fieldset>
    <fieldset id='filter1'>
        <legend>Filter</legend>
        <div class='span-6'>
            <div class='control-group'>
                <label for='filter1frequency'>Filter frequency</label>
                <input type='range' min='1' max='8' step='0.001' value='8' id='filter1frequency'>
            </div>
            <div class='control-group'>
                <label for='filter1Q'>Filter Q</label>
                <input type='number' min='0.0001' max='1000' step='0.0001' value='0.0001' id='filter1Q'>
            </div>
            <div class='control-group'>
                <label for='filter1Gain'>Filter gain</label>
                <input type='range' min='-40' max='40' value='0' id='filter1Gain'>
            </div>
            <div class='control-group'>
                <label for='filter1Type'>Filter type</label>
                <select id='filter1Type'>
                    <option value='lowpass'>Low Pass</option>
                    <option value='bandpass'>Band Pass</option>
                    <option value='highpass'>High Pass</option>
                    <option value='lowshelf'>Low Shelf</option>
                    <option value='highshelf'>High Shelf</option>
                    <option value='peaking'>Peaking</option>
                    <option value='notch'>Notch</option>
                    <option value='allpass'>All Pass</option>
                </select>
            </div>
        </div>
        <div class='span-6'>
            <div class='control-group'>
                <label for='filter1LfoFrequency'>Filter LFO frequency</label>
                <input type='range' min='0.01' max='8' step='0.01' value='0.01' id='filter1LfoFrequency'>
            </div>
            <div class='control-group'>
                <label for='lfo1Type'>Filter LFO waveform</label>
                <select id='lfo1Type'>
                    <option value='sine'>Sine</option>
                    <option value='square'>Square</option>
                    <option value='sawtooth'>Sawtooth</option>
                    <option value='triangle'>Triangle</option>
                </select>
            </div>
            <div class='control-group'>
                <label for='lfo1Gain'>Filter LFO gain</label>
                <input type='range' min='0' max='100' step='0.1' value='100' id='filter1LfoGain'>
            </div>
        </div>
    </fieldset>
    <fieldset id='oscillators' class='fieldset-group'>
        <legend>Oscillators</legend>
        <div class='control-group'>
            <label for='oscillator1Octave'>Osc1 frequency</label>
            <input type='range' min='1' max='8' step='0.001' value='2' id='oscillator1Octave'>
        </div>
        <div class='control-group'>
            <label for='oscillator2Detune'>Osc2 detune</label>
            <input type='range' min='-100' max='100' value='0' id='oscillator2Detune'>
        </div>
        <div class='control-group'>
            <label for='oscillator2Octave'>Osc2 octave</label>
            <input type='range' min='-2' max='2' step='1' value='-1' id='oscillator2Octave'>
        </div>
        <div class='control-group'>
            <label for='oscillator1Type'>Osc1 waveform</label>
            <select id='oscillator1Type'>
                <option value='sine'>Sine</option>
                <option value='square'>Square</option>
                <option value='sawtooth'>Sawtooth</option>
                <option value='triangle'>Triangle</option>
            </select>
        </div>
        <div class='control-group'>
            <label for='oscillator2Type'>Osc2 waveform</label>
            <select id='oscillator2Type'>
                <option value='sine'>Sine</option>
                <option value='square'>Square</option>
                <option value='sawtooth'>Sawtooth</option>
                <option value='triangle'>Triangle</option>
            </select>
        </div>
    </fieldset>
</form>
<script src='js/require.js' data-main='js/application'></script>
<script type='text/javascript'>
    document.querySelector('#oscilliscopeVisualiser').setAttribute('width', document.querySelector('#oscilliscope').clientWidth)
    document.querySelector('#volume').addEventListener('change', function(event){
        masterVolume.gain.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#dynamicsThreshold').addEventListener('change', function(event){
        compressor.threshold.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#dynamicsKnee').addEventListener('change', function(event){
        compressor.knee.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#dynamicsRatio').addEventListener('change', function(event){
        compressor.ratio.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#dynamicsReduction').addEventListener('change', function(event){
        compressor.reduction.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#dynamicsAttack').addEventListener('change', function(event){
        compressor.attack.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#dynamicsRelease').addEventListener('change', function(event){
        compressor.release.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });    
    document.querySelector('#vcaGain').addEventListener('change', function(event){
        gainStage.gain.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#vcaGainScale').addEventListener('change', function(event){
        document.querySelector('#vcaGain').setAttribute('max', event.target.value);
        document.querySelector('#vcaGain').setAttribute('step', event.target.value/100);
        setTimeout(drawWaveform, 500);
    });  
    document.querySelector('#vcaDistortion').addEventListener('change', function(event){
        distortion.setCurve(Number(event.target.value));
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#filter1frequency').addEventListener('change', function(event){
        filter1.frequency.value = Math.pow(2, event.target.value) * 55;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#filter1Q').addEventListener('change', function(event){
        filter1.Q.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#filter1Gain').addEventListener('change', function(event){
        filter1.gain.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#filter1Type').addEventListener('change', function(event){
        filter1.type = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#filter1LfoFrequency').addEventListener('change', function(event){
        lfo1.oscillator.frequency.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#filter1LfoGain').addEventListener('change', function(event){
        lfo1.gain.gain.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#lfo1Type').addEventListener('change', function(event){
        lfo1.oscillator.type = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#oscillator1Octave').addEventListener('change', function(event){
        osc1.frequency.value = Math.pow(2, event.target.value) * 55;
        osc2.frequency.value = osc1.frequency.value * Math.pow(2, document.querySelector('#oscillator2Octave').value);
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#oscillator2Detune').addEventListener('change', function(event){
        osc2.detune.value = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#oscillator2Octave').addEventListener('change', function(event){
        osc2.frequency.value = osc1.frequency.value * Math.pow(2, event.target.value);
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#oscillator1Type').addEventListener('change', function(event){
        osc1.type = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#oscillator2Type').addEventListener('change', function(event){
        osc2.type = event.target.value;
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#filter1Type').addEventListener('change', function(event){
        filter1.type = event.target.value;
        setTimeout(drawWaveform, 500);
    });    
    document.querySelector('#dualOscillatorsOn').addEventListener('click', function(event){
        playOscillators(0);
        setTimeout(drawWaveform, 500);
    });
    document.querySelector('#dualOscillatorsOff').addEventListener('click', function(event){
        osc1.stop(0);
        osc2.stop(0);
    });
    document.querySelector('#captureWaveform').addEventListener('click', function(event){
         setTimeout(drawWaveform, 500);
    });
    document.querySelector('#animateWaveform').addEventListener('click', function(event){
         animateWaveform();
    });
    document.querySelector('form').addEventListener('submit', function(event){
        event && event.preventDefault()    
    })
</script>
</body>
</html>
